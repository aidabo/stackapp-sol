/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import{d as ee,r as v,i as r,a as m,w as p,b as t,e as l,k as n,m as j,q as ge,B as te,P as se,s as ye,o as xe,v as we,n as $,x as be,F as T,g as Q,y as ke,z as X,j as b,f as D,u as Ce,h as Se,A as Pe,N,C as Ie,t as Y,S as Ee,p as Ge,l as $e,D as De,I as Ne,E as Ve,T as ze,G as Be,_ as Oe}from"./index-CDODInC4.js";import{c as Te,u as je,g as Z,a as Ae,_ as Me}from"./base64-CBs5qbV_.js";import{u as Fe}from"./PageLayoutStore-CqlQ4RXp.js";import{u as Le,_ as Re}from"./DefaultHandler-BYbWk2Qa.js";/* empty css              */const qe={class:"absolute top-1 right-1 text-xl"},Je={key:1,class:"flex flex-col"},He={class:"size-30"},Ue=ee({__name:"GridMenu",props:{gridId:{type:String,required:!0},lastGrid:{type:Boolean,default:!1}},emits:["grid:remove"],setup(g,{emit:V}){const i=g,u=V,o=v(!1),y=()=>{o.value=!o.value},h=()=>{u("grid:remove",i.gridId),o.value=!o.value};return(P,A)=>{const k=ge,I=te,z=se;return r(),m("div",qe,[o.value?(r(),m("div",Je,[t("div",He,[l(z,{content:"Are you sure you want to delete grid ",type:"info",onOk:h},{default:n(()=>[l(I,{type:"secondary",class:"text-lg",disabled:!g.lastGrid},{default:n(()=>[l(k),j("Delete")]),_:1},8,["disabled"])]),_:1})])])):(r(),m("i",{key:0,class:"fa-solid fa-pen-to-square grid-menu",onClick:p(y,["prevent"])}))])}}}),d=g=>(Ge("data-v-15549ade"),g=g(),$e(),g),We={class:"flex"},Ke={class:"flex-none"},Qe=d(()=>t("i",{class:"fa fa-solid fa-square-share-nodes"},null,-1)),Xe=[Qe],Ye={class:"flex-initial"},Ze=d(()=>t("i",{class:"fa fa-solid fa-save"},null,-1)),et=[Ze],tt={class:"flex-initial"},st=d(()=>t("i",{class:"fa fa-solid fa-refresh"},null,-1)),at=[st],ot={class:"flex-initial"},nt=d(()=>t("i",{class:"fa fa-solid fa-eraser"},null,-1)),lt=[nt],it={class:"flex-initial"},ct=d(()=>t("i",{class:"fa fa-solid fa-arrow-left"},null,-1)),rt=[ct],dt=d(()=>t("div",{id:"trash",style:{padding:"5px","margin-bottom":"10px"},class:"text-center text-white bg-amber-400"},[t("div",null,[t("i",{class:"fa fa-solid fa-trash",style:{"font-size":"250%"}})]),t("div",{class:"py-5"},[t("span",null,"Drop here to remove!")])],-1)),ut={class:"overflow-y-auto h-lvh"},ft={class:"newWidget grid-stack-item grid-custom"},pt=["gscomponent"],_t=d(()=>t("div",null,[t("i",{class:"fa fa-solid fa-plus",style:{"font-size":"200%"}})],-1)),vt={class:"h-10"},mt={class:"size-8 my-4"},ht={class:"flex justify-between align-items-center bg-blue-600 text-white"},gt={class:"ml-4 flex-1"},yt={class:"m-1"},xt=d(()=>t("i",{class:"fa fa-arrow-circle-right","aria-hidden":"true"},null,-1)),wt=[xt],bt={key:0},kt=d(()=>t("i",{class:"fa fa-solid fa-plus text-white size-6 justify-center mt-2"},null,-1)),Ct=d(()=>t("span",{class:"text-white"},"Increase Grid",-1)),St={class:"flex justify-between align-items-center"},Pt=d(()=>t("span",null,[t("i",{class:"fa-solid fa-fire"})],-1)),It=[Pt],Et=d(()=>t("span",null,[t("i",{class:"fa-solid fa-circle-info"})],-1)),Gt=[Et],$t=d(()=>t("span",null,[t("i",{class:"fa-solid fa-eye"})],-1)),Dt=[$t],Nt=d(()=>t("div",null,"Loading...",-1)),Vt=d(()=>t("div",{class:"flex flex-col justify-end align-items-center mb-5"},[t("div")],-1)),zt=ee({__name:"GridStackCreate",setup(g,{expose:V}){const i=v([]),u=v([]),o=v(Te()),y=v(!1),h=Ce(),P=Se(),A=s=>e=>{e&&(u.value[s]||(u.value[s]=e))},k=async(s,e,a)=>await _e(s,e,a),I=Le();I.fns.invoke=k;const z=ye({...I});Pe("__page_handlers",z);const C=v(!1),ae=()=>{C.value=!C.value},oe=()=>{C.value=!C.value},w=v({float:!1,compact:!1}),M=v(!1),F=v([]),{savePage:ne,getPageById:le}=Fe(),{gsComponentData:ie,gsGetComponentInfo:Bt}=je(),E=v(250);xe(async()=>{if(h.params.id&&h.fullPath.match(/\/page\/w/))L();else if(h.params.id&&h.fullPath.match(/\/page\/b\/w/))de();else{const s=o.value.grids||[];i.value=s.map(e=>e.id),i.value.length==0&&W()}}),we(()=>{console.log("unmount called when move from create...")});const ce=()=>{E.value=250},re=()=>{E.value=0},B=async s=>{u.value.forEach((e,a)=>{if(e){const _=s[a];e.load(_.items)}else e.load({id:1,x:2,y:1,h:2})})},de=async()=>{let s=localStorage.getItem(h.params.id);if(s){o.value=JSON.parse(Z.decode(s));const e=o.value.grids;i.value=e.map(a=>a.id),$(async()=>{await B(e)})}},L=async()=>{o.value=await le(h.params.id),i.value=o.value.grids.map(s=>s.id),$(async()=>{await B(o.value.grids)})},O=async(s=!1)=>{const e=Array();u.value.forEach((a,_)=>{a&&e.push({id:i.value[_],items:a.save()})}),o.value.grids=e,await ne(o.value),s||N.success({id:"page_create_save",title:"Success",content:"Saved successfully!"})},R=async()=>{u.value.forEach((s,e)=>{s&&s.clear()})},q=async()=>{const s=o.value.id;let e=Z.encode(JSON.stringify(H()));localStorage.setItem(s,e),P.push({name:"preview",params:{id:s}})},J=async()=>{o.value.status="published",await O(!0),N.success({id:"page_create_publish",title:"Success",content:"Published successfully!"}),setTimeout(()=>{const s=o.value.id;P.push({name:"page",params:{id:s}})},1e3)},ue=()=>{P.push({name:"pagelist"})};be(w.value,()=>{u.value.forEach((s,e)=>{s&&(s.float(w.value.float),w.value.compact&&s.compact(w.value.compact))})},{deep:!0});const H=()=>{const s=Array();u.value.forEach((a,_)=>{a&&s.push({id:i.value[_],items:a.save()})});const e=JSON.parse(JSON.stringify(o.value));return e.grids=s,e},U=()=>{F.value=H(),M.value=!0},W=()=>{const s=Ae();i.value.push(s.id),$(()=>{})},fe=async s=>{if(i.value.length==1)N.error({id:"delete_grid",title:"Error",content:"Only one grid in the layout, ignore delete!"});else if(i.value.find(e=>e==s))try{const e=i.value.findIndex(a=>a==s);if(e==i.value.length-1){const a=u.value[e];a.clear(),a.destroyGrid(s),i.value.splice(e,1),$(async()=>{const _=u.value.splice(0,u.value.length);i.value.forEach(f=>{const x=_.find(G=>G.props.id==f);u.value.push(x)})})}}catch{N.error({id:"delete_grid",title:"Error",content:"Grid deleted from layout error: "+s})}},pe=(s,e)=>u.value.map(a=>a.findCompFn(s,e)).flatMap(a=>a),_e=async(s,e,a)=>{const _=pe(s,e).map(f=>{let x=f.f(e,a);return x instanceof Promise?x:Promise.resolve(x)});return await Promise.all(_).then(f=>Promise.resolve(f))},ve=async()=>{(await k("test2",{cid:"",data:"test data in create! "})).forEach(e=>alert(e))};return V({showInfo:U,load:B,save:O,clear:R,preview:q,publish:J,invoke:k}),(s,e)=>{const a=De,_=Ne,f=Ie,x=Ve,G=te,S=ze,me=Be,he=se;return r(),m(T,null,[t("div",{id:"pageSidenav",class:"sidenav",style:X({width:E.value+"px"})},[t("div",We,[t("div",Ke,[t("a",{href:"#",class:"mybtn",onClick:e[0]||(e[0]=p(c=>J(),["prevent"]))},Xe)]),t("div",Ye,[t("a",{href:"#",class:"mybtn",onClick:e[1]||(e[1]=p(c=>O(),["prevent"]))},et)]),t("div",tt,[t("a",{href:"#",class:"mybtn",onClick:e[2]||(e[2]=p(c=>L(),["prevent"]))},at)]),t("div",ot,[t("a",{href:"#",class:"mybtn",onClick:e[3]||(e[3]=p(c=>R(),["prevent"]))},lt)]),t("div",it,[t("a",{href:"#",class:"mybtn",onClick:e[4]||(e[4]=p(c=>re(),["prevent"]))},rt)])]),dt,t("div",ut,[(r(!0),m(T,null,Q(ke(ie),c=>(r(),m("div",ft,[t("div",{class:"grid-stack-item-content drag",gscomponent:c.name},[_t,t("div",vt,[t("span",mt,Y(c.description),1)])],8,pt)]))),256))])],4),t("div",ht,[t("div",gt,[t("h1",yt,[t("button",{class:"text-stone-200 font-bold py-2 px-4 rounded hover:text-white",onClick:p(ce,["prevent"])},wt),l(f,{class:"ml-64 text-lg font-bold"},{default:n(()=>[C.value?(r(),b(a,{key:1,onChange:oe,style:{width:"320px"},modelValue:o.value.title,"onUpdate:modelValue":e[5]||(e[5]=c=>o.value.title=c)},null,8,["modelValue"])):(r(),m("span",bt,Y(o.value.title),1)),l(_,{class:"size-5 cursor-pointer",onClick:p(ae,["prevent"])})]),_:1}),l(f,{class:"mx-8 text-lg"},{default:n(()=>[j(" Compact "),l(x,{class:"mx-3",modelValue:w.value.compact,"onUpdate:modelValue":e[6]||(e[6]=c=>w.value.compact=c),"checked-color":"#14C9C9","unchecked-color":"lightgray"},null,8,["modelValue"])]),_:1}),y.value?D("",!0):(r(),b(f,{key:0,class:"mx-3 text-2xl font-bold",onClick:e[7]||(e[7]=p(c=>W(),["prevent"]))},{default:n(()=>[l(S,{content:"Add a grid into layout"},{default:n(()=>[l(G,{type:"outline"},{icon:n(()=>[kt]),default:n(()=>[Ct]),_:1})]),_:1})]),_:1}))])]),t("div",St,[l(f,{class:"mx-3 text-2xl font-bold"},{default:n(()=>[l(S,{content:"just for test"},{default:n(()=>[t("button",{onClick:e[8]||(e[8]=p(c=>ve(),["prevent"]))},It)]),_:1})]),_:1}),l(f,{class:"mx-3 text-2xl font-bold"},{default:n(()=>[l(S,{content:"Show page info"},{default:n(()=>[t("button",{onClick:p(U,["prevent"])},Gt)]),_:1}),l(Re,{show:M.value,items:F.value},null,8,["show","items"])]),_:1}),l(f,{class:"mx-3 text-2xl font-bold"},{default:n(()=>[l(S,{content:"Page Preview"},{default:n(()=>[y.value?D("",!0):(r(),m("button",{key:0,onClick:e[9]||(e[9]=p(c=>q(),["prevent"]))},Dt))]),_:1})]),_:1}),y.value?D("",!0):(r(),b(f,{key:0,class:"mx-3 text-2xl font-bold"},{default:n(()=>[l(S,{content:"Exit page design"},{default:n(()=>[l(he,{content:"Are you sure you want to exit ",type:"info",onOk:ue},{default:n(()=>[l(G,{type:"outline",status:"warning",style:{"font-weight":"600"}},{icon:n(()=>[l(me,{size:"18"})]),default:n(()=>[j("Exit Design")]),_:1})]),_:1})]),_:1})]),_:1}))])]),t("div",{class:"page-create",style:X({marginLeft:E.value+"px"})},[(r(!0),m(T,null,Q(i.value,(c,K)=>(r(),m("div",null,[(r(),b(Ee,null,{fallback:n(()=>[Nt]),default:n(()=>[(r(),b(Me,{id:c,ref_for:!0,ref:A(K),pageProps:o.value,pageStatic:y.value,key:c},{menu:n(()=>[y.value?D("",!0):(r(),b(Ue,{key:0,"grid-id":c,"last-grid":K==i.value.length-1&&i.value.length>1,"onGrid:remove":fe},null,8,["grid-id","last-grid"]))]),_:2},1032,["id","pageProps","pageStatic"]))]),_:2},1024))]))),256)),Vt],4)],64)}}}),Ut=Oe(zt,[["__scopeId","data-v-15549ade"]]);export{Ut as default};
